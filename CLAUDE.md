/c# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Development Commands

- **Install dependencies**: `uv sync`
- **Run the application**: `./run.sh` (or `uv run uvicorn backend/app:app --reload --port 8000`)
- **Add a new course document**: Place the file under `docs/` and run the server; it will be indexed on startup.
- **Re‑index all courses**: Stop the server and run `uv run backend/rag_system.py` (or edit `run.sh` to call `add_course_folder`).
- **Clear vector store**: Delete the `chroma_db/` directory or call the `clear_all_data` method via an interactive session.
- **Run a single query against the API** (with `curl`):
  ```bash
  curl -X POST http://localhost:8000/api/query \
       -H "Content-Type: application/json" \
       -d '{"query": "Your question", "session_id": null}'
  ```
- **View API documentation**: Open `http://localhost:8000/docs` in a browser.

## High‑Level Architecture

- **FastAPI entry point** (`backend/app.py`): defines HTTP endpoints, creates a `RAGSystem` instance, and handles request/response models.
- **RAGSystem** (`backend/rag_system.py`): orchestrates document processing, vector storage, AI generation, and session management.
- **DocumentProcessor** (`backend/document_processor.py`): reads raw files, extracts course metadata, splits text into overlapping chunks for indexing.
- **VectorStore** (`backend/vector_store.py`): wraps ChromaDB collections for course catalog metadata and content chunks; provides semantic search and utility helpers.
- **AIGenerator** (`backend/ai_generator.py` – not shown but used by `RAGSystem`): sends prompts to Anthropic Claude and handles tool calls.
- **SessionManager** (`backend/session_manager.py`): maintains short‑term conversation history per session.
- **SearchTools** (`backend/search_tools.py`): defines tool specifications for the language model to perform vector searches.
- **Models** (`backend/models.py`): Pydantic data classes representing `Course`, `Lesson`, and `CourseChunk`.
- **Configuration** (`backend/config.py`): loads environment variables, defines chunk size, model names, and paths.
- **Static Frontend**: Served from the `frontend/` directory via FastAPI’s `StaticFiles` mount.

## Indexing Workflow
1. **Add documents** to `docs/` (supported formats: PDF, DOCX, TXT).
2. On server startup (`run.sh`), `RAGSystem.add_course_folder` is called to process new files, extract metadata, and store both course‑level and chunk‑level vectors.
3. Existing courses are de‑duplicated by title using the catalog collection.
4. Each chunk includes contextual prefixes (lesson number, course title) to improve relevance.

## Session Management
- Sessions are identified by a UUID string returned in the `QueryResponse`. The last two exchanges are kept in memory (`MAX_HISTORY`).
- The same session ID can be reused to maintain context across multiple queries.

## Extending the System
- **Adding new search tools**: implement a subclass of `ToolBase` in `search_tools.py` and register it in `RAGSystem`.
- **Custom AI prompts**: modify the prompt construction in `RAGSystem.query`.
- **Alternative vector DB**: replace `VectorStore` implementation while keeping the same method signatures.

*Generated by Claude Code*